# การทดลองที่ 4 การเขียนโปรแกรมอินพุทสัญญาณดิจิทัล

### วัตถุประสงค์
1. เพื่อนำสัญญาณ input ภายนอกเข้ามายังภายใน microcontroller
2. เพื่อให้เข้าใจการทำงานของสัญญาณ สังเกต output ที่จะเกิดขึ้น 
3. เพื่อให้ใช้ sensor ในการดู input/output ของสภาพแวดล้อมได้

### อุปกรณ์ที่ใช้
1. CPU
2. adapter
3. sensorแสง
4. หลอด LED เปล่งแสง
5. microcontroller ESP-01
6. อุปกรณ์เชื่อมต่อ USB เข้าไปยัง serial

### แหล่งข้อมูลที่ศึกษา
https://www.youtube.com/watch?v=nFqoZT26U5k

### วิธีการทำการทดลอง
1. ทำการเสียบ microcontroller เข้าทาง serial port ของ USB 
2. ดูที่ตัวอย่างโปรแกรม ที่โฟลเดอร์ pattani
* พิมพ์ cd pattani เพื่อไปยังโฟลเดอร์
  * ไปที่ตัวอย่างที่ 4
    * พิมพ์ cd 04_Input-port  
3. ดู source code program
* พิมพ์ vi src/main.cpp
  * ส่วน set up
    * set up ให้ io port ที่มี 2 อัน
      * port 0 (สายสีขาว) เป็น input
      * port 2 (สายสีเหลือง) เป็น output
  * ส่วน loop
    - digitalRead() 
      - หากค่าที่อ่านได้ เป็น 1 ให้ LOW ไปที่ port 2 (หากเป็นหลอดไฟหมายถึงไฟดับ)
      - หากค่าที่อ่านได้ เป็น 0 ให้ HIGH ไปที่ port 2 (หากเป็นหลอดไฟหมายถึงไฟติด)
    โดยในที่นี้หมายความว่า port 0 เป็นตัวควบคุมสัญญาณ input ให้ไฟเปิด หรือ ปิด
```javascript
#include <Arduino.h>
#include <ESP8266WiFi.h>

int cnt = 0;

void setup()
{
 Serial.begin(115200);
 pinMode(0, INPUT);
 pinMode(2, OUTPUT);
 Serial.println("\n\n\n");
}

void loop()
{
 int val = digitalRead(0);
 Serial.printf("======= read %d\n", val);
 if(val==1) {
  digitalWrite(2, LOW);
 } else {
  digitalWrite(2, HIGH);
 }
 delay(100);
}
```
4. อัพโหลดโปรแกรมเข้าไปใน microcontroller
 * พิมพ์ pio run -t upload
 * กดปุ่มสีดำ เพื่อให้ทำการอัพโหลด
 * เมื่อโปรแกรมอัพโหลดเสร็จสิ้น โปรแกรมจะทำงานโดยการตรวจสอบที่ port 0
    * ถ้า input เป็น 1 ไฟจะติดที่ port 2
    * ถ้า input เป็น 0 ไฟจะไม่ติด

![1](https://user-images.githubusercontent.com/80879395/112316603-d4c0d380-8cdd-11eb-9511-d7a5be4990e2.jpg)

* พิมพ์ pio device monitor
    * ค่าที่อ่านได้เป็นจะ 1  ดังภาพ

![2](https://user-images.githubusercontent.com/80879395/112317024-3e40e200-8cde-11eb-92e4-7cfe2df52992.jpg)

* สายไฟเส้นสีขาว คือ port 0 ถ้าเอาสายไฟเส้นนี้ไปจิ้มจะมีค่าเป็น 0 Volt
  * นำสายไฟเส้นสีขาว จิ้มกับช่องที่มีสายสีดำเสียบอยู่ output อ่านค่าได้เป็น 0 ดังภาพ

![3](https://user-images.githubusercontent.com/80879395/112317246-6defea00-8cde-11eb-8e05-9e3e6c8850f1.jpg)

  * ปล่อยสายไฟเส้นสีขาวออกจาก ช่องที่มีสายสีดำ output เปลี่ยนกลับเป็น 1
  * นำสายไฟสีขาวไปจิ้มที่เส้นสีแดง out put อ่านค่าได้เป็น 1

![4](https://user-images.githubusercontent.com/80879395/112317694-e656ab00-8cde-11eb-989b-370d570107f5.jpg)

  * เมื่อกดปุ่มสีดำ ค่าที่ได้ออกมาจะมีค่าเช่นเดียวกับการกดport 0 ส่งผลให้ไฟติดดังภาพ

![5](https://user-images.githubusercontent.com/80879395/112317787-fa021180-8cde-11eb-96eb-7a8355a59613.jpg)

  * เมื่อปล่อยมือจากปุ่มสีดำ ไฟจะดับ และค่าที่อ่านได้เป็น 1 ดังภาพ

![6](https://user-images.githubusercontent.com/80879395/112317878-0d14e180-8cdf-11eb-891b-619c0eb62977.jpg)

5. นำ CPU มาต่อกับ sensorแสง (sensorแสงนั้นต่ออยู่กับตัวต้านทาน)
* ขาข้างแรก ต่อกับไฟเลี้ยงของCPU เส้นสีแดง(ขนาด 3 Volt)
* ขาถัดมา ต่อกับ resistor และเข้าไปต่อกับ port 0(จะต่อภายหลัง)
* อีกขา ต่อกับเส้นสีดำ หรือ ground
* นำ input เส้นสีขาวต่อกับ sensor 
  * ไฟ LED จะสว่าง เมื่อ sensor โดนแสงสว่าง ค่าที่อ่านได้เป็น 0 ดังภาพ

![8](https://user-images.githubusercontent.com/80879395/112319338-8b25b800-8ce0-11eb-91d2-c24874b711c3.jpg)

  * ไฟ LED จะดับ เมื่อนำนิ้วไปปิดหน้า sensor ค่าที่อ่านได้เป็น 1 ดังภาพ

![9](https://user-images.githubusercontent.com/80879395/112320134-4ea68c00-8ce1-11eb-8cd6-92cb7a243e68.jpg)

### การบันทึกผลการทดลอง

**ก่อนทำการต่อ sensorแสง**

การกระทำ | ค่าที่อ่านได้ | ลักษณะ LED
------------ | ------------- | ------------- 
สายสีขาว จิ้ม สายสีดำ | 0 | ไฟติด
สายสีขาว นำออกจากช่อง สายสีดำ | 1 | ไฟดับ
สายสีขาว จิ้ม สายสีแดง | 1 | ไฟดับ
กดปุ่มสีดำ | 0 | ไฟติด
ปล่อยมือจากปุ่มสีดำ | 1 | ไฟดับ

**หลังต่อ sensorแสง**

การกระทำ | ค่าที่อ่านได้ | ลักษณะ LED
------------ | ------------- | ------------- 
sensor ไม่ถูกบัง | 0 | ไฟติด
sensor ถูกบดบัง | 1 | ไฟดับ

### อภิปรายผลการทดลอง
- จากการทดลอง เมื่อโค้ดที่ถูกอ่านมีค่าเป็น 0 หมายถึง หลอดไฟจะสว่าง ในขณะเดียวกัน เมื่อค่าที่ถูกอ่านเป็น 1 หลอดไฟจะดับ 
- เมื่อทำการต่อ sensorแสง หากตัวsensorถูกบดบัง ค่าจะถูกอ่านเป็น 1 หลอดไฟจะดับ ในขณะเดียวกัน เมื่อsensorแสงไม่ถูกบัง หลอดไฟจะสว่าง

### คำถามหลังการทดลอง
หากนำโครงสร้างของ sensorแสง ไปปรับใช้ในชีวิตประจำวัน ข้อใดเหมาะสม
* ตอบ ไฟข้างทาง
